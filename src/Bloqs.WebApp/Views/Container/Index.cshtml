@model IEnumerable<ContainerViewModel>
<h2>Your containers</h2>
<div id="list-area">
    @{Html.RenderPartial("_List", Model);}
</div>

<p><button class="btn btn-primary btn-partial-view" data-url="@Url.Action("Create")">Add new container</button></p>
@section scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(function () {
            $(document).on("click", ".btn-pagination", function () {
                var self = this;
                var url = $(self).data("url");

                $.get(url, function (data) {
                    $("#list-area").html(data);
                });
            });

            $(document).on("submit", "form", function (e) {
                e.preventDefault();
                var $form = $(this);
                var $button = $form.find('input[type=submit]');

                $.ajax({
                    url: $form.attr('action'),
                    type: $form.attr('method'),
                    data: $form.serialize(),
                    beforeSend: function (xhr, settings) {
                        $button.attr('disabled', true);
                    },
                    complete: function (xhr, textStatus) {
                        $button.attr('disabled', false);
                    },
                    success: function (result, textStatus, xhr) {
                        if (result) {
                            $("#container").html(result);
                        } else {
                            $('#modal').modal('hide');
                            refresh();
                        }
                    },
                    error: function (xhr, textStatus, error) {
                    }
                });
            });

            $(document).on("click", ".btn-maintain-key", function () {
                var self = this;
                var keyno = $(self).data("keyno");
                var url = $(self).data("url");

                $.post(url, { "keyno": keyno },
                    function(data) {
                        $("#PrimaryAccessKey").val(data.PrimaryAccessKey);
                        $("#copy-key-1").data("clipboard-text", data.PrimaryAccessKey);
                        $("#SecondaryAccessKey").val(data.SecondaryAccessKey);
                        $("#copy-key-2").data("clipboard-text", data.SecondaryAccessKey);
                        refresh();
                    });
            });

            var refresh = function () {
                var url = $("#refresh-list").val();

                $.get(url, function (data) {
                    $("#list-area").html(data);
                });
            }
        });
    </script>
}
